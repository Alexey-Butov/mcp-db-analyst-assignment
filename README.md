MCP Database Analyst Agent
A minimal MCPâ€‘style system consisting of two components:

1. Readâ€‘Only SQLite Server (FastAPI)

Exposes two tools:
list_tables()
run_sql_query(query)

2. AI Agent (Groq LLM)

The agent:
Understands naturalâ€‘language questions (Hebrew or English)
Discovers the database schema
Generates SQL queries
Executes them via the server
Performs selfâ€‘correction on SQL errors
Returns clear naturalâ€‘language answers
This project demonstrates schema reasoning, SQL generation, error handling, and toolâ€‘based interaction in an MCPâ€‘style architecture.

ğŸ“‚ Project Structure
Code
mcp-db-analyst/
â”œâ”€â”€ agent/
â”‚ â”œâ”€â”€ **init**.py
â”‚ â”œâ”€â”€ agent.py
â”‚ â””â”€â”€ requirements.txt
â”‚
â”œâ”€â”€ common/
â”‚ â”œâ”€â”€ **init**.py
â”‚ â””â”€â”€ prompts.py
â”‚
â”œâ”€â”€ server/
â”‚ â”œâ”€â”€ server.py
â”‚ â”œâ”€â”€ init_db.py
â”‚ â”œâ”€â”€ db.sqlite3
â”‚ â””â”€â”€ requirements.txt
â”‚
â”œâ”€â”€ tests/
â”‚ â”œâ”€â”€ test_agent_end_to_end.py
â”‚ â”œâ”€â”€ test_llm.py
â”‚ â”œâ”€â”€ test_readonly.py
â”‚ â””â”€â”€ test_valid_queries.py
â”‚
â”œâ”€â”€ .env
â”œâ”€â”€ architecture.txt
â””â”€â”€ README.md
âš™ï¸ Installation
Prerequisites
Python 3.10+

Internet connection (Groq API)

Groq API key (free)

ğŸ”‘ Environment Setup
Create a .env file in the project root:

Code
GROQ_API_KEY=your_api_key_here
GROQ_MODEL=llama-3.3-70b-versatile
MCP_SERVER_URL=http://127.0.0.1:8000
Get your Groq API key at:
https://console.groq.com

ğŸ—„ï¸ Initialize the SQLite Database

Inside the server/ folder:
bash
cd server
python init_db.py

This creates db.sqlite3 with two tables:
products
orders

and populates them with sample data.

ğŸš€ Run the Readâ€‘Only MCPâ€‘Style Server
Install dependencies:

bash
pip install -r server/requirements.txt
Run the server:

bash
python server/server.py
Expected output:

Code
Uvicorn running on http://127.0.0.1:8000
The server exposes:
GET /list_tables
POST /run_sql_query
All SQL is validated as readâ€‘only (SELECT / WITH only).
ğŸ¤– Run the AI Agent
Install agent dependencies:

bash
pip install -r agent/requirements.txt
Run from project root (recommended)
bash
python agent/agent.py "××” ×”××•×¦×¨ ×”×›×™ ×–×•×œ?"
Run from inside the agent folder
bash
cd agent
python agent.py "××” ×”××•×¦×¨ ×”×›×™ ×–×•×œ?"
Run as a module
bash
python -m agent.agent "××” ×”××•×¦×¨ ×”×›×™ ×–×•×œ?"

ğŸ’¬ Ask Naturalâ€‘Language Questions
Examples:
bash
python agent/agent.py "××” ×”××•×¦×¨ ×”×›×™ × ××›×¨ ×‘×××™?"
python agent/agent.py "×›××” ×”×›× ×¡×•×ª ×”×™×• ×‘×™×•× ×™?"
python agent/agent.py "×ª×Ÿ ×œ×™ ××ª ×›×œ ×”×”×–×× ×•×ª ×©×œ ×—×•×“×© ×™×•×œ×™"

The agent will:
Fetch table list
Inspect schema
Generate SQL using Groq LLM
Execute SQL via the server
Selfâ€‘correct if needed
Return a clear naturalâ€‘language answer

ğŸ” Selfâ€‘Correction Mechanism
If SQL generated by the LLM fails:
The agent captures the SQLite error
Sends it back to the LLM
Requests a corrected SQL query
Retries up to 3 times
If all attempts fail, the agent returns a clear explanation.

ğŸ§  About common/prompts.py
The system prompt defines:

Readâ€‘only SQL rules
Workflow and tool usage
Errorâ€‘handling behavior
Output format
This ensures consistent and safe SQL generation.

ğŸ§ª Running Tests
The project includes:
Endâ€‘toâ€‘end agent tests
LLM behavior tests
SQL validity tests
Readâ€‘only enforcement tests
Run the full suite:

bash
pytest tests/ -v
Expected output:

Code
10 passed in X.XXs
ğŸ›  Technologies Used
Python
FastAPI (server)
SQLite (readâ€‘only DB)
Groq LLM
pythonâ€‘dotenv
requests
pytest

ğŸ¯ Summary
This project demonstrates:
MCPâ€‘style tool architecture
AIâ€‘driven SQL generation
Automatic schema discovery
Readâ€‘only database protection
Selfâ€‘correction loops
Clear naturalâ€‘language explanations
The system is fully functional and ready for submission.
